<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="en-us" http-equiv="Content-Language" />
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>Homework 4</title>
<style>
h4{
	margin:4px;
	padding:0;
}
button{
	margin:16px;
}
.centered{
    margin:auto;
	text-align:center;
	vertical-align:middle;
	height:100px;
	position:absolute;
	top:50%;
	margin-top:-50px;
	width:100%;
}
</style>
<script>
	
	var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    //xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status === 200) {
        callback(null, xhr.responseText);
      } else if(status === 404){
		alert("Page not found");
        //callback(status, xhr.response);
      }else{
		callback(status, xhr.response);
	  }
    };
	xhr.error = function(e) {
            alert("There is some kind of error ");
    };
    xhr.send();
};

function submitQuery(){
	var html = "<html><head></head><body><table border=\"2\" width=\"100%\"><tr>";
	var query = document.getElementById("query").value;
	if(query == ""){
		alert("Please enter URL first");
	}else{
		getJSON(query,function(err, data) {
			if (err !== null) {
				alert('Something went wrong: ' + err);
			} else {
				try {
					//var result = JSON.stringify(data);
					var obj = JSON.parse(data);
					var headerRow = obj.Mainline.Table.Header.Data;
					//iterate table headers
					for(i=0;i<headerRow.length;i++){
						html += "<th>"+headerRow[i]+"</th>";
					}
					html += "</tr>";
	
					if(obj.Mainline.Table.hasOwnProperty('Row')){
						//load data into cells
						var rows = obj.Mainline.Table.Row;
	
						//check if rows have data
						if(rows.length>0){
	
							for(i=0;i<rows.length;i++){
								var row = rows[i];
								html += "<tr>";
								html += "<td>"+row.Company+"</td>";
								html += "<td>"+row.Services+"</td>";
								html += "<td><ul>";
								for(j=0;j<row.Hubs.Hub.length;j++){
									var hub = row.Hubs.Hub[j];
									html += "<li>";
									if(j==0){
										html += "<b>"+hub+"</b>";
									}else{
										html += hub;
									}
									html += "</li>";
								}
								html += "</ul></td>";
								html += "<td>"+row.Revenue+"</td>";
								html += "<td><a href=\""+row.HomePage+"\">"+row.HomePage+"</a></td>";
								html += "<td><center><img src=\""+row.Logo+"\" height=\"150px\"></center></td></tr>";
							}
	
							html += "</table></body></html>";
							//alert(html);
							hWin = window.open("", "Assignment4", "height=800,width=600");
							hWin.document.write(html);
						}else{
							alert("Response contains no data");
						}
					}else{
						alert("Response contains no data");
					}
				}catch(e) {
					alert("This file is not a JSON file");
				}
			}
		});
	}
}
</script>
</head>

<body>

<div class="centered">
	<h4>Enter URL for Trucking List JSON File</h4><br/>
	<input type="text" style="width:150px;" id="query"/><br />
	<button onclick="submitQuery()">Submit Query</button></div>
</body>

</html>
